{% extends 'base.html' %}


{% block content %}


<style type="text/css">
    .form-signin {
    width: 100%;
    max-width: 900px;
    padding: 30px;
    margin: auto;
    }
    .form-signin .form-control {
    /* position: relative; */
    box-sizing: border-box;
    height: auto;
    padding: 10px;
    font-size: 18px;
    margin-bottom: 20px;
    }
    .form-signin .form-control:focus {
    z-index: 2;
    }
    .form-signin input[type="email"] {
    margin-bottom: 10px;
    border-radius: 10px;
    }
    .form-signin input[type="text"] {
    margin-bottom: 20px;
    border-radius: 10px;
    }
    
    /* Style the tab */
.tab {
  float: left;
  {% comment %} background-color: #f1f1f1; {% endcomment %}
  width: 20%;
  padding-right: 20px;
  margin-top: 30px;
  margin-left: 30px;
  min-width: 180px;
  overflow: visible;
}
.card-body{
	padding: 15px;
	word-wrap: break-word;
	border-bottom-right-radius: 25px;
	border-bottom-left-radius: 25px;
}
.nodeco{
	text-decoration: none;
}
.nodeco:hover{
	text-decoration: none;
}
/* Style the buttons inside the tab */
.tab button {
  display: block;
  background-color: inherit;
  color: black;
  padding: 15px 15px;
  width: 100%;
  border: 1px #b5b5b5 solid;
  outline: none;
  text-align: left;
  cursor: pointer;
  transition: 0.3s;
  font-size: 17px;
  margin-bottom: 10px;
  border-radius: 10px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #c2dafbc3;
  color: #22559e;
}

/* Create an active/current "tab button" class */
.tab button.active {
background-color: #c2dafbc3;
box-shadow: 0px 10px 20px #a2a2a27b;

}
#pretestButton{
	margin-left: 0px;
	width: 30%;  
	margin-top: 20px; 
	text-align: center; 
	height: 400px; 
	background-color: #0C6DFD; 
	display: flex; 
	justify-content: center; 
	align-items: center;
	cursor: pointer;
	margin-right: 3%;
}
/* Style the tab content */
.tabcontent {
  {% comment %} float: left; {% endcomment %}
  {% comment %} width: 65%; {% endcomment %}
  {% comment %} box-shadow: 0px 10px 20px #a2a2a27b; {% endcomment %}
{% comment %} border-radius: 10px; {% endcomment %}
}
.button{
  box-shadow: 0px 4px 20px 0px #49c628a6;
  background-image: linear-gradient(135deg, #70F570 10%, #49C628 100%);
  border: none;
}
.card-section:hover {
	box-shadow: -2px -2px 6px rgba(255, 255, 255, .5), -2px -2px 4px rgba(255, 255, 255, .3), 2px 2px 2px rgba(255, 255, 255, .05), 2px 2px 4px rgba(0, 0, 0, .1);
}
.card-section:active  {
	box-shadow: inset -2px -2px 6px rgba(255, 255, 255, .7), inset -2px -2px 4px rgba(255, 255, 255, .5), inset 2px 2px 2px rgba(255, 255, 255, .075), inset 2px 2px 4px rgba(0, 0, 0, .15);
}
.card-section{
	background-color: #F3F0F1;
	width: 100%;
	margin: 30px;
	padding: 10px;
	border: transparent;
	transition: .2s ease-in-out;
	box-shadow: -6px -6px 14px rgba(255, 255, 255, .7),
		  -6px -6px 10px rgba(255, 255, 255, .5),
		  6px 6px 8px rgba(255, 255, 255, .075),
		  6px 6px 10px rgba(0, 0, 0, .15);
	border-radius: 25px;
}
#container{
margin-top: 20px;
width: 30%; 
margin-right: 3%; 
margin-bottom: 20px;
}
.smallScreen{
	display: none;
}
.bigScreen{
	display: block;
}
@media only screen and (max-width: 1005px) {
    #container{
		width: 45%; 
	}
	#pretestButton{
		width: 45%;
	}

}
@media only screen and (max-width: 740px) {
	.smallScreen {
		display: block;
    } 
	.bigScreen{
		display: none;
	}
}
@media only screen and (max-width: 510px) {
	#container{
		width: 90%; 
		margin-left:10px;
	}
	#pretestButton{
		width: 90%;
		height: 100px;
		margin-left:10px;
		margin-top: 10px;
		margin-bottom: 15px;
	}
}
select.mySelectArrow{
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    color: grey;
    width: 100%;
    padding: 10px 20px;
    font-size: 15px;

}
select.mySelectArrow option {
    color: #000;
    padding: 0 10px;
}
.select:after {
    content: "â–¼";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    font-size: 15px;
    {% comment %} border: 1px solid #565656; {% endcomment %}

    color: black;
    padding: 15px 15px;
    pointer-events: none;
}
.select {
    position: relative;
    width: 90%;
	margin-left: 5%;
	margin-right: 5%;
	margin-top: 10px;
}

a.disabledLink {
    position: relative;
    display: inline-block;
}

a.disabledLink .overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
	align-items: center;
    justify-content: center;
	border-radius: 25px;
    background-color: rgba(0, 0, 0, 0.5); /* Black with 50% opacity */
    z-index: 2;
}

</style>

<title>Topics - Dementia Learn</title>
<div class="fill p-3" style="overflow: visible; display: flex; margin-top: -100px; justify-content: center; align-items: center; position:relative; background-color: #F2A5A5; height: 320px;">
	<h1 class="p-3" style="color: white; font-weight: 600;margin-top: 70px; ">Browse our sections</h1>
</div>

<div style="min-height: 10px; overflow: hidden; ">

	<div class="select smallScreen">
		<select id="sectionSelect" class="mySelectArrow" style="border-radius: 10px; height: 50px;">
		  {% for section, score in section_info.items %}
		  {% if forloop.counter == 1 %}
		  <option class="tablinks" data-value="{{ section.display_order }}">{{ section.title }}</option>
		  {% else %}
		  <option class="tablinks" data-value="{{ section.display_order }}">{{ section.title }}</option>
			{% endif %}
		  {% endfor %}
		</select>
	  </div>
		<div class="tab bigScreen">
				{% for section, score in section_info.items %}
				<button class="tablinks" style="width: 100%;" onclick="openSet(event, '{{ section.display_order }}')" 
				{% if forloop.counter == 1 %}
					id="defaultOpen"
				{% endif %}>
					<div class="column" style="width: 100%; ">
						<h5>{{ section.title }}</h5>
					</div>
					<div>
				<progress style="width: 100%;" id="file" value="{{ score }}" max="100"> {% widthratio count.result count.topic 100 %}% </progress>
				  <p>{{ score }}% complete</p>     
			</div>
		</button>
		{% endfor %} 
	{% comment %} </div>   {% endcomment %}
  		</div>
   	<!-- Sections -->
	{% for section, section_info in section_topics_dict.items %}
	<div id='{{ section_info.section.display_order }}' class="tabcontent">
			<div style="display: flex; flex-wrap: wrap; padding-left: 2%; border-left: 2px #b5b5b5 solid;">
				
				{% if not section_info.pretest.slug %}
				<div class="card-section " id="pretestButton" style="background-color: #FF0000;">
					<h5 style="color: white; cursor: pointer;">Contact admin: Pretest link not found</h5>
				</div>
				{% elif request.user.is_superuser %}
				<div class="card-section" style="background-color:#990033;" id="pretestButton" onclick="location.href='{% url 'preposttest:pretest' section_info.pretest.slug %}';">
					<h5 style="color: white; cursor: pointer;">Pretest admin preview. Results won't be saved</h5>
				</div>
				{% elif not section_info.pretest_found %}
				<div class="card-section " id="pretestButton" onclick="location.href='{% url 'preposttest:pretest' section_info.pretest.slug %}';">
					<h5 style="color: white; cursor: pointer;">Click HERE to do the pretest</h5>
				</div>
				{% else %}
				<div class="card-section " id="pretestButton" onclick="alertPopUp('Pretest can only be done once')" style="background-color: #09DD91;">
					<h5 style="color: white; cursor: pointer;">PRETEST DONE</h5>
				</div>
				{% endif%}

				{% for blog_post, score, prev_result, reading_time in section_info.blog_posts %}
					<div id="container" class="p-0">
						{% if prev_result.score == 100.00 or request.user.is_superuser %}

						<a class="nodeco" href="{% url 'blog:detail' blog_post.slug %}">
							<div class="card-section m-auto p-0" style="position: relative; height:400px;">
								<img class="card-img-top" src="{{blog_post.image.url}}" style="width: 100%; height: 200px; border-top-left-radius: 25px; border-top-right-radius: 25px; object-fit: cover;">
								<div class="card-body mt-0 mb-0">
									<h5 class="text-dark " style="font-size: 18px;">{{blog_post.title}}</h5>
									<p style="color: grey; margin-bottom: 8px;">{{reading_time}} minutes</p> 
										  {% if request.user.is_superuser %}
										  <a href="{% url 'blog:edit' blog_post.slug %}" class="btn btn-primary">Update</a>
										 {% else %} 
										  <progress style="width: 100%; margin-top: -5px;" id="file" value="{{ score }}" max="100"> {% widthratio count.result count.topic 100 %}% </progress>
										  <p class="text-dark ">{{ score }}% complete</p>     
										  {% endif %}
								</div>
							</div>
						</a>

						{% else %}

							<a href="#" onclick="alertPopUp('Make sure you have done the previous quizzes or pretest')" style="width: 100%; " class="nodeco locked disabledLink">
								<div class="py-0 card-section m-auto p-0 position: relative; display: inline-block;" style="position: relative; height:400px;">
									<img class="card-img-top" src="{{blog_post.image.url}}" style="height: 200px; border-top-left-radius: 25px; border-top-right-radius: 25px; object-fit: cover;">
										<div><img class="overlay" style="padding: 35%; object-fit: contain;" src="https://i.ibb.co/d5wkdQf/lock-outline-24px.png" alt="lock" width="10%" border="0"></div>
									<div class="card-body mt-0 mb-0">
										<h5 class="text-dark " style="font-size: 18px;">{{blog_post.title}}</h5>
										<p style="color: grey; margin-bottom: 8px;">{{reading_time}} minutes</p> 
											  {% if request.user.is_superuser %}
											  <!-- <a href="{% url 'blog:edit' blog_post.slug %}" class="btn btn-primary">Update</a> -->
											 {% else %} 
											  <progress style="width: 100%; margin-top: -5px;" id="file" value="{{ score }}" max="100"> {% widthratio count.result count.topic 100 %}% </progress>
											  <p class="text-dark ">{{ score }}% scored</p>     
											  {% endif %}
									</div>
								</div>
							</a>

						{% endif %}
					</div>
				{% endfor %}

				{% if not section_info.posttest.slug %}

				<div class="card-section " id="pretestButton" style="background-color: #FF0000;">
					<h5 style="color: white; cursor: pointer;">Contact admin: Posttest link not found</h5>
				</div>

				{% elif request.user.is_superuser %}

				<div class="card-section" style="background-color:#990033;" id="pretestButton" onclick="location.href='{% url 'preposttest:pretest' section_info.posttest.slug %}';">
					<h5 style="color: white; cursor: pointer;">Posttest admin preview. Results won't be saved</h5>
				</div>

				{% elif section_info.posttest_status == 1 %}

				<div class="card-section " style="background-color:#990033;" id="pretestButton" onclick="alertPopUp('Posttest not available as all of the quizzes is not done yet.')">
					<h5 style="color: white; cursor: pointer;">Posttest not available yet</h5>
				</div>

				{% elif section_info.posttest_status == 2 %}

				<div class="card-section " id="pretestButton" onclick="location.href='{% url 'preposttest:pretest' section_info.posttest.slug %}';">
					<h5 style="color: white; cursor: pointer;">Click HERE to do the posttest</h5>
				</div>
				
				{% else %}

				<div class="card-section " id="pretestButton" onclick="alertPopUp('Posttest can only be done once')" style="background-color: #09DD91;">
					<h5 style="color: white; cursor: pointer;">POSTTEST DONE</h5>
				</div>
				{% endif %}

				{% if section_info.posttest_status != 3 %}
				  <div class="card-section " id="pretestButton" style="background-color: rgba(0, 0, 0, 0.1);"onclick="alertPopUp('Please finish your posttest to claim certificate');">
					<h5 style="color: rgba(0, 0, 0, 0.2); cursor: pointer;">Finish posttest to download certificate</h5>
				  </div>
				{% else %}
				  <div class="card-section " id="pretestButton" style="background-color: #F2A5A5;"onclick="location.href='{% url 'cert_pdf' section %}';">
					<h5 style="color: white; cursor: pointer;">Download your certificate for {{ section }}</h5>
				  </div>
				{% endif %}
			</div>
	</div>
	{% endfor %}
	<!-- End of sections -->
</div>

<script>
	function alertPopUp(text) {
  	alert(text);
	}

    var disabledLinks = document.querySelectorAll('.disabledLink');
    disabledLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
            // Prevent the default behavior (navigating to a new page)
            event.preventDefault();
        });
    });

  function openSet(evt, setType) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(setType).style.display = "block";
    evt.currentTarget.className += " active";
  }
  
  document.addEventListener("DOMContentLoaded", function () {
    // Find with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();
	document.getElementById("sectionSelect").addEventListener("change", filterContent);

  });

	 function filterContent() {
      var selectedOption = sectionSelect.options[sectionSelect.selectedIndex].getAttribute('data-value');
	  var tabcontents = document.getElementsByClassName("tabcontent");
	  console.log(selectedOption)
  
	  for (var i = 0; i < tabcontents.length; i++) {
		if (tabcontents[i].id === selectedOption) {
		  tabcontents[i].style.display = "block";
		} else {
		  tabcontents[i].style.display = "none";
		}
	  }
	}
  
	// Set up event listener to trigger the filtering when the dropdown value changes
  
	// Initial filtering on page load
	filterContent(); 
  </script>
  

{% endblock content %}